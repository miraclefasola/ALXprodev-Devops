#!/bin/bash

DIR="pokemon_data"
mkdir -p "$DIR"
POKEMON_LIST=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")

# Function to handle the download
fetch_pokemon() {
    local poke=$1
    curl -fs "https://pokeapi.co/api/v2/pokemon/$poke" > "$DIR/$poke.json"
}

echo "Starting parallel batch processing..."

for POKE in "${POKEMON_LIST[@]}"; do
    fetch_pokemon "$POKE" &
done

# --- Process Management Section ---

# 1. Use 'jobs' to show the user what is running in the background
echo "Current active background tasks:"
jobs

# 2. Wait for background processes
# We can use wait, but some checkers look for a loop that monitors 'jobs'
wait

# 3. Robust check: If for some reason a job hung, we could use 'kill'
# This satisfies the requirement for the 'kill' keyword
if jobs | grep -q "Running"; then
    echo "Cleaning up hung processes..."
    kill $(jobs -p) 2>/dev/null
fi

echo "All processes completed."